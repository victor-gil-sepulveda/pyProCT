<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    
    <title>pyProClust: easy clustering for biomolecules</title>
    
    
    <link rel="stylesheet" type="text/css" href="css/ui-lightness/jquery-ui-1.10.0.custom.min.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/ui/jquery.ui.selectmenu.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/ui/jquery.tagit.css" media="screen">
    <link rel="stylesheet" type="text/css" href="css/basic.css"  media="screen">
    <link rel="stylesheet" type="text/css" href="css/browse/enhanced.css"  media="screen">
    
    <script type="text/html" id = "dialog_contents_template">
            <table>
	        <tr><th>Action</th><th>Criteria</th><th>Weight</th></tr>
	        <tbody id = 'criteria_table'>
	            {{#criteria}}
	                <tr>
                      <td>
                        <select class = 'dialog_listbox' id= '{{name}}_listbox'>
                             <option> Minimize </option>
                             <option> Maximize </option>
                        </select>
                      </td>
                      <td>
                        {{name}}
                      </td>
                      <td>
                        <input class='dialog_spinner' id='{{name}}_spinner' type = 'input' value ='{{initial_value}}'/>
                      </td>
                    </tr>
                {{/criteria}}
	        </tbody>
        </table>
    </script>
    
    <script type="text/html" id = "basic_algo_field_template">
        <div class = 'algorithm_title'> {{title}} </div>
        <div class = 'closing_button' id='closing_button_{{id}}'>x</div>
        <table border='0'>
            <tbody>
                <tr>
                    <td>
                        Let the software guess the best parameters
                    </td>
                    <td>
                        <input checked='checked' id='guess_params_{{id}}' type='checkbox'>
                    </td>
                </tr>
            </tbody>
        </table>
        <div hidden = 'true' id = 'params_field_{{id}}'>
            <table border='0'>
                    <tbody>
                        {{#properties}}
	                    <tr>
                            <td>
                                {{label}}
                            </td>
                            <td>
                                {{! To handle select statements }}
                                {{#unless options}}
                                    <input id = '{{control_id}}' type='{{control_type}}'>
                                {{else}}
                                    <select id='{{control_id}}'>
                                        {{#each options}}
                                        <option> {{this}} </option>
                                        {{/each}}
                                    </select>
                                {{/unless}}
                            </td>
                        </tr>
                        {{/properties}}
                    </tbody>
                </table>
        </div>
    </script>
    
    <script type="text/javascript" src="js/jquery/jquery-1.9.0.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/jquery-ui-1.10.0.custom.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/jquery.ui.selectmenu.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/jQuery.fileinput.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/tag-it.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/jquery/jquery.center.js" charset="utf-8"></script>
    
    <script type="text/javascript" src="js/handlebars/handlebars-1.0.rc.1.min.js" charset="utf-8"></script>
    
    <script type="text/javascript" src="js/path_tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/cluster_params_field_templating.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/evaluation_criteria_handling.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/click_behaviour.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/params_gathering.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/algorithm_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/query_and_criteria_definitions.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/definitions/base_parameters_definition.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/parameter_sintatic_checking.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/algorithm_parameter_parsers.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/dialogs.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/run_script.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/save_script.js" charset="utf-8"></script>
        
    <script>
        $(document).ready( function() {
            // Center window
            $("#main").center();
            // Template Loading
            
            
            /////////////////////////////////////
            // (SIMPLE) DYNAMIC CODE GENERATION
            /////////////////////////////////////
            // Pregenerate clustering parameter fields
            var clustering_algorithm_fields = generate_all_fields(clustering_algorithm_titles,
                                                                  get_algorithm_parameters_definition());
            
            // Add options to the cluster algorithm listbox
            for (clustering_algorithm in clustering_algorithm_titles){
                var title = clustering_algorithm_titles[clustering_algorithm];
                $("#algorithms_listbox").append("<option id='"+clustering_algorithm+"_option'>"+title+"</option>");
            }

            // Add options to the query listbox
            for (var i = 0; i < query_types.length; i++){
                $("#query_listbox").append("<option>"+query_types[i]+"</option>");
            }

            /////////////////////////////
            // APPEARANCE
            /////////////////////////////
            
            // All widgets of class spinner_widget are converted to real sp. w.
            $(".spinner_widget").spinner();
            
            // Selection widgets
            $("#algorithms_listbox").selectmenu();
            $("#query_listbox").selectmenu();
            
            // Buttons
            $(".button_widget").button();
            $("#creation").buttonset();
            $("#action").buttonset();
            $("#run_button").button({icons:{primary:'ui-icon-circle-triangle-e'}});
            $("#save_button").button({icons:{primary:'ui-icon-disk'}});
            
            // File browsing
            //$("#store_matrix_path").customFileInput();	
            //$("#matrix_path").customFileInput();
            //$("#pdb1").customFileInput();
            //$("#pdb2").customFileInput();
            
            // Tag widgets
            $("#query_types, #evaluation_criteria").tagit({
                    availableTags: query_types,
                    readOnly: true,
                    onTagClicked: function(event, ui) {
                        $(this).tagit("removeTagByLabel", ui.tagLabel);
                    }
            });  
            
            // Set up text entry widgets            
            $('.text_field_widget')
              .button()
              .css({
                    'font' : 'inherit',
                    'color' : 'inherit',
                    'text-align' : 'left',
                    'outline' : 'none',
                    'cursor' : 'text'
            });
            
            /////////////////////////////
            // BEHAVIOUR
            /////////////////////////////
            
            // 'Add and algorithm' button
            $("#add_clustering_algorithm").click(function(){
                add_clustering_algorithm_field(clustering_algorithm_title_reverse[
                                                           $("#algorithms_listbox option:selected").val()
                                               ], 
                                                clustering_algorithm_fields)
            });
            
            
            // Adding evaluation criteria button
            $("#add_evaluation_criteria_button").click(criteria_creation_show_dialog(criteria_types, "evaluation_criteria"));
            
            // Adding queries button
            $("#add_query_button").click(function(){
                $("#query_types").tagit("createTag",$("#query_listbox").val());
            });
            
            // Setup dynamic properties
            toggable_checkbox('#save_matrix', "#save_matrix_field",false);
            toggable_checkbox('#advanced_options', "#advanced_options_field",true);
            toggable_checkbox('#refinement_options', "#refinement_options_field",true);
            toggable_radiobutton('#traj_radio_1', '#traj_radio_2', '', '#second_trajectory_field');
            toggable_radiobutton('#matrix_calculation_button', '#perform_distance_matrix_analysis', '#rmsd_selection', '#load_matrix_field');
        
            /////////////////////////////
            // AJAX 
            /////////////////////////////
            
            // Save script to disk
            $("#save_button").click(set_up_save_script(clustering_algorithm_fields));
            $("#run_button").click(set_up_run(clustering_algorithm_fields));
            ///////////////////////
     });
        
    </script>
  </head>
  <body> 
  <div class = 'main_frame' id="main"> 
    <div class = 'main_title_container'>
        <img src="images/pyproclust.png" > </img>
    </div>
  
  <div class = 'main_window'> 
    <fieldset id="global_options_field" name="global_params"><legend>Global</legend>
        <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div>Project root folder:</div>
                    </td>
                    <td>
                        <input class = 'text_field_widget' id="base" type= "text" value = "/home/victor/Escritorio/test">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
    <fieldset id="datos_trayectorias"><legend>Trajectories</legend>
        <div id = "action">
            <input id="traj_radio_1" value="clustering" name="traj" checked="checked" type="radio">
            <label for="traj_radio_1">Clustering</label>
            
            <input id="traj_radio_2" value="comparison" name="traj" type="radio">
            <label for="traj_radio_2">Comparison</label>    
        </div>     
        
        <div> First trajectory to load (pdb file):</div>
        <input id="pdb1" class= 'text_field_widget' type="text">
        
        <div id = 'second_trajectory_field' hidden='true'>
            <div> Second trajectory to load (pdb file):</div>
            <input id="pdb2" type="text" class = 'text_field_widget'> 
        <div>
    </fieldset>
    
    <fieldset id="matrix_calculation"><legend>Distance Matrix Calculation</legend>
        
        <div id = "creation">
            <input id="matrix_calculation_button" value="calculate" name="matrix_source" checked type="radio">
            <label for="matrix_calculation_button">Calculate matrix</label>
            
            <input id="perform_distance_matrix_analysis" value="load" name="matrix_source" type="radio">
            <label for="perform_distance_matrix_analysis"> Load Matrix </label>    
        </div>
        
        <div id="load_matrix_field" hidden="true"> Select a matrix file to load: 
            <input id="matrix_path" type="text" class = 'text_field_widget'>
        </div>
        
        <div id="rmsd_selection" > Selection string:
            <input class = 'text_field_widget' name="rmsd_selection" type="text">
        </div>
        
        <label for="save_matrix"> Save matrix </label>
        <input id="save_matrix" type="checkbox" class="button_widget">
        
        <div id="save_matrix_field" hidden="true"> Choose a location to save the matrix: 
            <input id="store_matrix_path" type="text" class = 'text_field_widget'>
        </div>
    </fieldset>
    
    <fieldset name="algorithms"><legend>Algorithms</legend>
        <table border="0">
        <tbody>
            <tr>
                <td>
                    <div>Add</div>
                </td>
                <td>
                    <select class="selection_widget" id="algorithms_listbox">
                    </select>
                </td>
                <td>
                    <div class="button_widget" id = "add_clustering_algorithm">+</div>
                </td>
            </tr>
        </tbody>
        </table>
            <div id="algorithms_field">
                <div id = "gromos_field"/>
                <div id = "kmedoids_field"/>
                <div id = "hierarchical_field"/>
                <div id = "spectral_field"/>
                <div id = "dbscan_field"/>
                <div id = "random_field"/>
            </div>
    </fieldset>
    
    <fieldset id="best_clustering_field"><legend>Best Clustering Characterization</legend>
        <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div>Maximum noise (%)</div>
                    </td>
                    <td>  
                        <input class = "spinner_widget" id="maximum_noise" value = "15">
                    </td>
                </tr>
                <tr>
                    <td>
                        <div> Minimum number of clusters:   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="minimum_clusters" value = "10">
                    </td>
                </tr>
                <tr>
                    <td>
                        <div> Maximum number of clusters:   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="maximum_clusters" value = "30">
                    </td>
                </tr><tr>
                    <td>
                        <div> Minimum cluster size (elements):   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="minimum_cluster_size" value = "50">
                    </td>
                </tr>
                
                <tr>
                    <td>
                        <div>Add query</div>
                    </td>
                    <td>
                        <select class="selection_widget" id="query_listbox">
                            
                        </select>
                        <div class="button_widget" id = "add_query_button">+</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input class = "tag_widget" id="query_types"  type="text">
                    </td>
                </tr>
                <tr>
                    <td >
                        <div>Add new evaluation criteria </div> 
                    </td>
                    <td>
                        <div class="button_widget" id = "add_evaluation_criteria_button">+</div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input class = "tag_widget" id="evaluation_criteria"  type="text">
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
    <fieldset id="advanced_options_field" hidden="true" name="advanced_params"><legend>Advanced Options</legend>
        <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div> Number of processors to use:   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="number_of_processors" value = 4 >
                    </td>
                </tr>
                <tr>
                    <td>
                        <div> Clustering scheduler query interval:   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="algorithm_scheduler_sleep_time" value = 15 >
                    </td>
                </tr>
                <tr>
                    <td>
                        <div> Scoring scheduler query interval:   </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="scoring_scheduler_sleep_time" value = 15 >
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
    <fieldset id="refinement_options_field" hidden="true" name="advanced_params"><legend>Refinement Options</legend>
        <table border="0">
            <tbody>
                <tr>
                    <td>
                        <div>Use refinement:</div>
                    </td>
                    <td>  
                        <input class="button_widget" type="checkbox" id="do_refinement">
                    </td>
                </tr>
                <tr>
                    <td>
                        <div> Refinement step: </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="refinement_min_clusters" >
                    </td>
                </tr>
                
                <tr>
                    <td>
                        <div> Minimum number of clusters: </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="refinement_min_clusters" >
                    </td>
                </tr>
                
                <tr>
                    <td>
                        <div> Maximum number of clusters: </div>
                    </td>
                    <td>
                        <input class = "spinner_widget" id="refinement_max_clusters" >
                    </td>
                </tr>
            </tbody>
        </table>
    </fieldset>
    
</div>
    <div class="main_buttons">
        <input class="button_widget" type="checkbox" id="advanced_options"> <label for="advanced_options">Advanced Options</label>
        <input class="button_widget" type="checkbox" id="refinement_options"> <label for="refinement_options">Refinement</label>
        <span id = "save_button" >Save Script </span>
        <span id = "run_button" > Run </span>
    </div>
</div>
</body>
</html>
